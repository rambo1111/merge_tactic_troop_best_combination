<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5-Trait Troop Combinations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
        }
        .card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.75rem;
        }
        #loader {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Elite Combinations with 5 Activated Traits</h1>
        </header>

        <!-- Loader -->
        <div id="loader-container" class="flex flex-col items-center justify-center my-16">
            <div id="loader" class="w-16 h-16 border-4 border-gray-700 rounded-full"></div>
            <p class="text-gray-400 mt-4">Finding all 5-trait combinations...</p>
        </div>

        <!-- Filter UI -->
        <div class="mb-6 flex flex-col sm:flex-row gap-4 items-center justify-center">
            <div class="relative w-full sm:w-96">
                <input id="troop-filter" type="text" placeholder="Type troop name..."
                    class="w-full p-2 rounded-lg border border-gray-700 bg-gray-800 text-gray-100 focus:outline-none" list="troop-list">
                <datalist id="troop-list"></datalist>
            </div>
            <button id="add-troop-filter" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium">
                Add Troop
            </button>
        </div>

        <!-- Selected Troops -->
        <div id="selected-troops" class="flex flex-wrap gap-2 mb-6 justify-center"></div>

        <!-- Results Count -->
        <p id="results-count" class="hidden text-center text-gray-400 mb-6 font-medium"></p>

        <!-- Results Grid -->
        <main id="combinations-grid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></main>
    </div>

    <script>
        // --- DATA ---
        const troops = [
            { "name": "Archer", "traits": ["Clan", "Ranger"], "image": "https://api-assets.clashroyale.com/cards/300/W4Hmp8MTSdXANN8KdblbtHwtsbt0o749BbxNqmJYfA8.png" },
            { "name": "Archer Queen", "traits": ["Clan", "Avenger"], "image": "https://api-assets.clashroyale.com/cards/300/p7OQmOAFTery7zCzlpDdm-LOD1kINTm42AwIHchZfWk.png" },
            { "name": "Bandit", "traits": ["Ace", "Avenger"], "image": "https://api-assets.clashroyale.com/cards/300/QWDdXMKJNpv0go-HYaWQWP6p8uIOHjqn-zX7G0p3DyM.png" },
            { "name": "Barbarian", "traits": ["Clan", "Brawler"], "image": "https://api-assets.clashroyale.com/cards/300/TvJsuu2S4yhyk1jVYUAQwdKOnW4U77KuWWOTPOWnwfI.png" },
            { "name": "Bomber", "traits": ["Undead", "Thrower"], "image": "https://api-assets.clashroyale.com/cards/300/12n1CesxKIcqVYntjxcF36EFA-ONw7Z-DoL0_rQrbdo.png" },
            { "name": "Dart Goblin", "traits": ["Goblin", "Ranger"], "image": "https://api-assets.clashroyale.com/cards/300/BmpK3bqEAviflqHCdxxnfm-_l3pRPJw3qxHkwS55nCY.png" },
            { "name": "Executioner", "traits": ["Ace", "Thrower"], "image": "https://api-assets.clashroyale.com/cards/300/9XL5BP2mqzV8kza6KF8rOxrpCZTyuGLp2l413DTjEoM.png" },
            { "name": "Giant Skeleton", "traits": ["Undead", "Brawler"], "image": "https://api-assets.clashroyale.com/cards/300/0p0gd0XaVRu1Hb1iSG1hTYbz2AN6aEiZnhaAib5O8Z8.png" },
            { "name": "Goblin", "traits": ["Goblin", "Assassin"], "image": "https://api-assets.clashroyale.com/cards/300/X_DQUye_OaS3QN6VC9CPw05Fit7wvSm3XegXIXKP--0.png" },
            { "name": "Goblin Machine", "traits": ["Goblin", "Juggernaut"], "image": "https://api-assets.clashroyale.com/cards/300/-iLlotr6GCFndL_1BSBqWBb6DnsHBhLerd5EblZDNfU.png" },
            { "name": "Golden Knight", "traits": ["Noble", "Assassin"], "image": "https://api-assets.clashroyale.com/cards/300/WJd207D0O1sN-l1FTb8P9KhYL2oF5jY26vRUfTUW3FQ.png" },
            { "name": "Knight", "traits": ["Noble", "Juggernaut"], "image": "https://api-assets.clashroyale.com/cards/300/jAj1Q5rclXxU9kVImGqSJxa4wEMfEhvwNQ_4jiGUuqg.png" },
            { "name": "Mega Knight", "traits": ["Ace", "Brawler"], "image": "https://api-assets.clashroyale.com/cards/300/O2NycChSNhn_UK9nqBXUhhC_lILkiANzPuJjtjoz0CE.png" },
            { "name": "P.E.K.K.A", "traits": ["Ace", "Juggernaut"], "image": "https://api-assets.clashroyale.com/cards/300/MlArURKhn_zWAZY-Xj1qIRKLVKquarG25BXDjUQajNs.png" },
            { "name": "Prince", "traits": ["Noble", "Brawler"], "image": "https://api-assets.clashroyale.com/cards/300/3JntJV62aY0G1Qh6LIs-ek-0ayeYFY3VItpG7cb9I60.png" },
            { "name": "Princess", "traits": ["Noble", "Ranger"], "image": "https://api-assets.clashroyale.com/cards/300/bAwMcqp9EKVIKH3ZLm_m0MqZFSG72zG-vKxpx8aKoVs.png" },
            { "name": "Royal Ghost", "traits": ["Undead", "Assassin"], "image": "https://api-assets.clashroyale.com/cards/300/3En2cz0ISQAaMTHY3hj3rTveFN2kJYq-H4VxvdJNvCM.png" },
            { "name": "Skeleton King", "traits": ["Undead", "Juggernaut"], "image": "https://api-assets.clashroyale.com/cards/300/dCd69_wN9f8DxwuqOGtR4QgWhHIPIaTNxZ1e23RzAAc.png" },
            { "name": "Spear Goblin", "traits": ["Goblin", "Thrower"], "image": "https://api-assets.clashroyale.com/cards/300/FSDFotjaXidI4ku_WFpVCTWS1hKGnFh1sxX0lxM43_E.png" },
            { "name": "Valkyrie", "traits": ["Clan", "Avenger"], "image": "https://api-assets.clashroyale.com/cards/300/0lIoYf3Y_plFTzo95zZL93JVxpfb3MMgFDDhgSDGU9A.png" }
        ];

        const traitsData = {
            "Ace": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/ace.png", "tiers": ["2 Troops: Captain gains 30% bonus damage.", "4 Troops: Captain gains 60% bonus damage and gains +30% HP of damage dealt."] },
            "Assassin": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/assassin.png", "tiers": ["3 Troops: +35% Critical Chance and Critical Damage."] },
            "Avenger": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/avenger.png", "tiers": ["3 Troops: +30% bonus damage."] },
            "Brawler": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/brawler.png", "tiers": ["2 Troops: +30% bonus HP.", "4 Troops: +60% for Brawlers, +30% for the team."] },
            "Clan": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/clan.png", "tiers": ["2 Troops: +30% of max HP and Hit Speed.", "4 Troops: +60% of max HP and Hit Speed for Clans, +30% for the team."] },
            "Goblin": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/goblin.png", "tiers": ["2 Troops: Gain a 2-Elixir Goblin.", "4 Troops: +60% chance of gaining a 3 or 4-Elixir Goblin."] },
            "Juggernaut": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/juggernaut.png", "tiers": ["2 Troops: +15% bonus Shield, Juggernauts +30%", "4 Troops: +30% bonus Shield, Juggernauts +60%"] },
            "Noble": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/noble.png", "tiers": ["2 Troops: 20% less Damage and bonus Damage.", "4 Troops: 40% less Damage and bonus Damage."] },
            "Ranger": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/ranger.png", "tiers": ["3 Troops: +15% Hit Speed."] },
            "Thrower": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/thrower.png", "tiers": ["3 Troops: +10% Damage per Hex."] },
            "Undead": { "icon": "https://www.deckshop.pro/img/merge-tactics/traits/undead.png", "tiers": ["2 Troops: Curses 1 enemy, max HP cut by 25%", "4 Troops: Curses 2 enemies, max HP cut by 50%"] }
        };

        // Populate datalist
        const troopListEl = document.getElementById('troop-list');
        troops.forEach(t => {
            const option = document.createElement('option');
            option.value = t.name;
            troopListEl.appendChild(option);
        });

        let selectedTroops = [];
        let fiveTraitCombinations = [];

        // Add troop to filter
        document.getElementById('add-troop-filter').addEventListener('click', addTroopFromInput);
        document.getElementById('troop-filter').addEventListener('keypress', e => {
            if (e.key === 'Enter') addTroopFromInput();
        });

        function addTroopFromInput() {
            const input = document.getElementById('troop-filter');
            const troopName = input.value.trim();
            if (troopName && troops.some(t => t.name.toLowerCase() === troopName.toLowerCase()) && !selectedTroops.includes(troopName)) {
                selectedTroops.push(troopName);
                renderSelectedTroops();
                filterResults();
            }
            input.value = '';
        }

        function renderSelectedTroops() {
            const container = document.getElementById('selected-troops');
            container.innerHTML = '';
            selectedTroops.forEach(name => {
                const troop = troops.find(t => t.name === name);
                const tag = document.createElement('div');
                tag.className = 'bg-blue-700 text-white px-3 py-1 rounded-full flex items-center gap-2';
            
                tag.innerHTML = `
                    <img src="${troop.image}" alt="${name}" class="w-6 h-6 rounded-full">
                    <span>${name}</span>
                    <button class="text-red-400 font-bold">&times;</button>
                `;
            
                tag.querySelector('button').addEventListener('click', () => {
                    selectedTroops = selectedTroops.filter(t => t !== name);
                    renderSelectedTroops();
                    filterResults();
                });
            
                container.appendChild(tag);
            });
        }


        function filterResults() {
            const grid = document.getElementById('combinations-grid');
            grid.innerHTML = '';
            const filtered = selectedTroops.length === 0
                ? fiveTraitCombinations
                : fiveTraitCombinations.filter(combo =>
                    selectedTroops.every(sel => combo.troops.some(t => t.name === sel))
                );

            if (filtered.length === 0) {
                grid.innerHTML = `<p class="text-center text-gray-400 md:col-span-2 lg:col-span-3">No combinations found for selected troops.</p>`;
            } else {
                const fragment = document.createDocumentFragment();
                filtered.forEach(comboData => {
                    fragment.appendChild(createCombinationCard(comboData));
                });
                grid.appendChild(fragment);
            }

            // Always show grid when results ready
            grid.classList.remove('hidden');
        }

        // Calculation
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(calculateAndDisplay, 50);
        });

        function calculateAndDisplay() {
            const allCombinations = getCombinations(troops, 6);
            const combinationsWithTraits = allCombinations.map(combo => ({
                troops: combo,
                activatedTraits: getActivatedTraits(countTraits(combo))
            }));
            fiveTraitCombinations = combinationsWithTraits.filter(c => c.activatedTraits.length === 5);

            document.getElementById('loader-container').style.display = 'none';
            document.getElementById('results-count').textContent =
                `Found ${fiveTraitCombinations.length} combinations with exactly 5 activated traits.`;
            document.getElementById('results-count').classList.remove('hidden');

            filterResults();
        }

        function countTraits(combo) {
            const traitCounts = {};
            combo.forEach(troop => troop.traits.forEach(trait => {
                traitCounts[trait] = (traitCounts[trait] || 0) + 1;
            }));
            return traitCounts;
        }

        function getCombinations(arr, k) {
            const result = [];
            function combine(startIndex, currentCombination) {
                if (currentCombination.length === k) {
                    result.push([...currentCombination]);
                    return;
                }
                if (startIndex >= arr.length) return;
                currentCombination.push(arr[startIndex]);
                combine(startIndex + 1, currentCombination);
                currentCombination.pop();
                combine(startIndex + 1, currentCombination);
            }
            combine(0, []);
            return result;
        }

        function getActivatedTraits(traitCounts) {
            const activated = [];
            for (const traitName in traitCounts) {
                const count = traitCounts[traitName];
                const availableTiers = traitsData[traitName].tiers;
                if (!availableTiers) continue;
                let highestActivatedTier = null;
                availableTiers.forEach(tierDescription => {
                    const requiredCount = parseInt(tierDescription.match(/^\d+/)[0], 10);
                    if (count >= requiredCount) {
                        highestActivatedTier = tierDescription;
                    }
                });
                if (highestActivatedTier) {
                    activated.push({ name: traitName, description: highestActivatedTier, icon: traitsData[traitName].icon });
                }
            }
            return activated;
        }

        function createCombinationCard(comboData) {
            const card = document.createElement('div');
            card.className = 'card p-4 flex flex-col space-y-4';
            const troopsHtml = `<div><h3 class="text-lg font-semibold text-white mb-2">Troops</h3>
                <div class="flex flex-wrap gap-2">
                ${comboData.troops.map(troop => `<div class="bg-gray-700 p-2 rounded-lg text-center">
                    <img src="${troop.image}" alt="${troop.name}" class="w-12 h-12 mx-auto mb-1">
                    <span class="text-sm text-gray-300">${troop.name}</span>
                </div>`).join('')}</div></div>`;
            const traitsHtml = `<div><h3 class="text-lg font-semibold text-white mb-2">Activated Traits (5)</h3>
                <ul class="space-y-2">
                ${comboData.activatedTraits.map(trait => `<li class="flex items-center space-x-3">
                    <img src="${trait.icon}" alt="${trait.name}" class="w-8 h-8 rounded-full">
                    <span class="font-semibold text-red-400">${trait.name}</span>
                    <span class="text-gray-300 text-sm">${trait.description}</span>
                </li>`).join('')}</ul></div>`;
            card.innerHTML = troopsHtml + traitsHtml;
            return card;
        }
    </script>
</body>
</html>
